     1                                  BOOT_LOAD equ 0x7c00 ; ブートプログラムのロード位置
     2                                  ORG BOOT_LOAD ; ロードアドレスをアセンブラに指示
     3                                  
     4                                  entry: ; エントリーポイント
     5 00000000 EB58                        jmp ipl ; IPLへジャンプ
     6                                  
     7                                      ; BPB(BIOS Parameter Block)
     8 00000002 90<rep 58h>                 times 90 - ($ - $$) db 0x90 ; NOPで90バイト分のBPB領域を埋める
     9                                      
    10                                  
    11                                  ipl: ; IPL(Initial Program Loader)
    12                                  
    13                                      ; セグメントレジスタを設定する
    14 0000005A FA                          cli ; 割り込みを禁止する
    15 0000005B B80000                      mov ax, 0x0000 ; AX=0x0000
    16 0000005E 8ED8                        mov ds, ax ; DS=0x0000
    17 00000060 8EC0                        mov es, ax ; ES=0x0000
    18 00000062 8ED0                        mov ss, ax ; ss=0x0000
    19 00000064 BC007C                      mov sp, BOOT_LOAD ; sp=0x7c00
    20                                  
    21 00000067 FB                          sti ; セグメントレジスタの初期化が終わったので、割り込みを許可する
    22                                  
    23 00000068 8816[8600]                  mov [BOOT.DRIVE], dl ; ブートドライブを保存
    24                                      
    25                                      ; 文字を表示
    26 0000006C 6A41                        push    word 'A'
    27 0000006E E81700                      call    putc
    28 00000071 83C402                      add     sp, 2
    29                                      
    30 00000074 6A42                        push    word 'B'
    31 00000076 E80F00                      call    putc
    32 00000079 83C402                      add     sp, 2
    33                                  
    34 0000007C 6A43                        push    word 'C'
    35 0000007E E80700                      call    putc
    36 00000081 83C402                      add     sp, 2
    37                                      
    38                                      ; 処理の終了
    39 00000084 EBFE                        jmp $ ; while(1); 無限ループ
    40                                  
    41                                  ALIGN 2, db 0
    42                                  BOOT: ; ブートドライブに関する情報
    43 00000086 0000                    .DRIVE: dw 0 ; ドライブ番号を保存する場所。(アセンブル段階では0を記入しておく)
    44                                  
    45                                  ; モジュール
    46                                  %include    "../modules/real/putc.s"
    47                              <1> putc:
    48                              <1>     ; スタックフレームの構築
    49 00000088 55                  <1>     push    bp              ;   +4| 出力文字、引数
    50 00000089 89E5                <1>     mov     bp, sp          ;   +2| 呼び出し元のアドレス
    51                              <1>                             ; BP+0| 元のBP
    52                              <1> 
    53                              <1>     ; レジスタの保存
    54 0000008B 50                  <1>     push    ax
    55 0000008C 53                  <1>     push    bx
    56                              <1> 
    57                              <1>     ; 処理の開始
    58 0000008D 8A4604              <1>     mov     al, [bp+4]      ; 出力文字を取得
    59 00000090 B40E                <1>     mov     ah, 0x0E        ; テレタイプ式1文字入力
    60 00000092 BB0000              <1>     mov     bx, 0x0000      ; ページ番号と文字色を0に設定
    61 00000095 CD10                <1>     int     0x10            ; ビデオBIOSコール
    62                              <1> 
    63                              <1>     ; レジスタの復帰
    64 00000097 5B                  <1>     pop     bx
    65 00000098 58                  <1>     pop     ax
    66                              <1> 
    67                              <1>     ; スタックフレームの破棄
    68 00000099 89EC                <1>     mov     sp, bp
    69 0000009B 5D                  <1>     pop     bp
    70                              <1> 
    71 0000009C C3                  <1>     ret
    47                                  
    48                                  ; ブートフラグ
    49 0000009D 00<rep 161h>                times 510 - ($ - $$) db 0x00 ; 510バイト目まで0x00で埋める
    50 000001FE 55AA                        db 0x55, 0xAA ; ブートフラグ
    51                                  
    52                                  
